{"version":3,"sources":["../../../src/utils/Strict.ts"],"sourceRoot":"./","sourcesContent":["// file: /src/utils/Strict.ts\r\n\r\nimport { StrictLoggerNS } from './Log';\r\n\r\ninterface IStrictOptions {\r\n\tmaxAllowedInfo: number;\r\n\tmaxAllowedWarn: number;\r\n\tmaxAllowedError: number;\r\n\tmaxAllowedFatal: number;\r\n\tprintImmediate: boolean;\r\n}\r\n\r\nconst DefaultStrictOptions: Required<IStrictOptions> = {\r\n\tmaxAllowedInfo: Number.POSITIVE_INFINITY,\r\n\tmaxAllowedWarn: Number.POSITIVE_INFINITY,\r\n\tmaxAllowedError: Number.POSITIVE_INFINITY,\r\n\tmaxAllowedFatal: 0,\r\n\tprintImmediate: true,\r\n};\r\n\r\ninterface IStrictState {\r\n\tinfoCount: number;\r\n\twarnCount: number;\r\n\terrorCount: number;\r\n\tfatalCount: number;\r\n\tlogBook: StrictLoggerNS.StrictLogEntry[];\r\n}\r\n\r\nabstract class Strict {\r\n\r\n\tprivate readonly _initialOptions: Readonly<Required<IStrictOptions>>;\r\n\r\n\tprivate readonly _printImmediate: boolean = true;\r\n\r\n\tprivate _infoCount: number = 0;\r\n\tprivate _warnCount: number = 0;\r\n\tprivate _errorCount: number = 0;\r\n\tprivate _fatalCount: number = 0;\r\n\r\n\tprivate readonly _maxAllowedInfo: number = 0;\r\n\tprivate readonly _maxAllowedWarn: number = 0;\r\n\tprivate readonly _maxAllowedError: number = 0;\r\n\tprivate readonly _maxAllowedFatal: number = 0;\r\n\r\n\tprivate _logBook: StrictLoggerNS.StrictLogEntry[] = [];\r\n\r\n\tconstructor(options: Partial<IStrictOptions>) {\r\n\t\tthis._initialOptions = Object.freeze(Object.assign({}, DefaultStrictOptions, options));\r\n\t\tthis._resetCounters();\r\n\t}\r\n\r\n\tprivate _printEntry(logEntry: StrictLoggerNS.StrictLogEntry): void {\r\n\t\tswitch (logEntry.severity) {\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Info:\r\n\t\t\t\tconsole.info(`[STRICT] Infor: ${logEntry.text}`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Warn:\r\n\t\t\t\tconsole.warn(`[STRICT] Warni: ${logEntry.text}`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Error:\r\n\t\t\t\tconsole.error(`[STRICT] Error: ${logEntry.text}`);\r\n\t\t\t\tbreak;\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Fatal:\r\n\t\t\t\tconsole.error(`[STRICT] Fatal: ${logEntry.text}`);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(`[STRICT] Unknown severity: ${logEntry.severity}`);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _addEntry(logEntry: StrictLoggerNS.StrictLogEntry): void {\r\n\t\tthis._logBook.push(logEntry);\r\n\r\n\t\tswitch (logEntry.severity) {\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Info:\r\n\t\t\t\tif (++this._infoCount > this._maxAllowedInfo) {\r\n\t\t\t\t\tthis._flush();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Warn:\r\n\t\t\t\tif (++this._warnCount > this._maxAllowedWarn) {\r\n\t\t\t\t\tthis._flush();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Error:\r\n\t\t\t\tif (++this._errorCount > this._maxAllowedError) {\r\n\t\t\t\t\tthis._flush();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase StrictLoggerNS.StrictLogger.Severity.Fatal:\r\n\t\t\t\tif (++this._fatalCount > this._maxAllowedFatal) {\r\n\t\t\t\t\tthis._flush();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(`[STRICT] Unknown severity: ${logEntry.severity}`);\r\n\t\t}\r\n\r\n\t\tif (this._printImmediate) {\r\n\t\t\tthis._printEntry(logEntry);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _flush(): void {\r\n\t\tconsole.error(`[STRICT] FLUSH LOGBOOK`);\r\n\t\tfor (const failure of this._logBook) {\r\n\t\t\tthis._printEntry(failure);\r\n\t\t}\r\n\t\tprocess.exit(1);\r\n\t}\r\n\r\n\tprotected _resetCounters(): void {\r\n\t\tthis._infoCount = 0;\r\n\t\tthis._warnCount = 0;\r\n\t\tthis._errorCount = 0;\r\n\t\tthis._fatalCount = 0;\r\n\t}\r\n\r\n\tprotected log(severity?: StrictLoggerNS.StrictLogger.Severity, message?: string, ...args: any[]): void {\r\n\t\tthis._addEntry( new StrictLoggerNS.StrictLogEntry(severity || StrictLoggerNS.StrictLogger.Severity.Error, message || \"Fail!\", ...args));\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\nexport class ClampedInt extends Strict {\r\n\r\n\tpublic readonly min: number = Number.MIN_SAFE_INTEGER;\r\n\tpublic readonly max: number = Number.MAX_SAFE_INTEGER;\r\n\r\n\tprivate _value: number = 0;\r\n\r\n\tconstructor(value: number, min: number = Number.MIN_SAFE_INTEGER, max: number = Number.MAX_SAFE_INTEGER, options: Partial<IStrictOptions> = {}) {\r\n\t\tsuper(options);\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\t\tthis.value = value;\r\n\t}\r\n\r\n\tprivate _parse(value: any): number|null {\r\n\r\n\t\tif (typeof value === \"number\") {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Warn, \"Value should not be undefined\");\r\n\t\t\t}\r\n\t\r\n\t\t\tif (value === null) {\r\n\t\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Warn, \"Value should not be null\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Warn, `Value should be a number, not a ${typeof value}`);\r\n\r\n\t\t\t\r\n\t\t\tconst maybeInt = parseInt(value);\r\n\r\n\t\t\tif (!isNaN(maybeInt)) {\r\n\t\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Info, `Was able to parse directly as integer`);\r\n\t\t\t\treturn maybeInt; // int is \"number\"\r\n\t\t\t}\r\n\r\n\t\t\tconst maybeFloat = parseFloat(value);\r\n\t\t\tif (!isNaN(maybeFloat)) {\r\n\t\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Info, `Parsed as float, but should be an integer`);\r\n\t\t\t\treturn Math.round(maybeFloat); // float is \"number\"\r\n\t\t\t}\r\n\r\n\t\t\tconst maybeOther = Number(value);\r\n\t\t\tif (!isNaN(maybeOther)) {\r\n\t\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Warn, `Parsed as number, but should be an integer`);\r\n\t\t\t\treturn maybeOther; // number\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tprivate _clamp(value: number): number {\r\n\t\t\r\n\t\tif (value < -128 || value > 127) {\r\n\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Warn, `Value should be in the range -128 to 127, not ${value}`);\r\n\t\t}\r\n\r\n\t\tif (value < -128) {\r\n\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Info, `Clamping value to -128`);\r\n\t\t\tvalue -128;\r\n\t\t}\r\n\r\n\t\tif (value > 127) {\r\n\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Info, `Clamping value to 127`);\r\n\t\t\tvalue = 127;\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tget value(): number {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tset value(value: any) {\r\n\t\t\r\n\t\tconst parsed = this._parse(value);\r\n\t\t\r\n\t\tif (parsed === null) {\r\n\t\t\tthis.log(StrictLoggerNS.StrictLogger.Severity.Error, `Value could not be parsed`);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst clamped = this._clamp(parsed);\r\n\r\n\t\t\tif (clamped !== this._value) {\r\n\r\n\t\t\t\tthis._value = clamped;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (value !== this._value) {\r\n\t\t\tthis._value = value;\r\n\t\t}\r\n\r\n\t\tthis._value = value;\r\n\t}\r\n\r\n\tinc(): void {\r\n\t\tthis.value++;\r\n\t}\r\n\r\n\tdec(): void {\r\n\t\tthis.value--;\r\n\t}\r\n\r\n}\r\n\r\n"],"names":["ClampedInt","DefaultStrictOptions","maxAllowedInfo","Number","POSITIVE_INFINITY","maxAllowedWarn","maxAllowedError","maxAllowedFatal","printImmediate","Strict","_initialOptions","_printImmediate","_infoCount","_warnCount","_errorCount","_fatalCount","_maxAllowedInfo","_maxAllowedWarn","_maxAllowedError","_maxAllowedFatal","_logBook","constructor","options","Object","freeze","assign","_resetCounters","_printEntry","logEntry","severity","StrictLoggerNS","StrictLogger","Severity","Info","console","info","text","Warn","warn","Error","error","Fatal","_addEntry","push","_flush","failure","process","exit","log","message","args","StrictLogEntry","min","MIN_SAFE_INTEGER","max","MAX_SAFE_INTEGER","_value","value","_parse","undefined","maybeInt","parseInt","isNaN","maybeFloat","parseFloat","Math","round","maybeOther","_clamp","parsed","clamped","inc","dec"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA,6BAA6B;;;;;+BA8HhBA;;;eAAAA;;;qBA5HkB;AAU/B,MAAMC,uBAAiD;IACtDC,gBAAgBC,OAAOC,iBAAiB;IACxCC,gBAAgBF,OAAOC,iBAAiB;IACxCE,iBAAiBH,OAAOC,iBAAiB;IACzCG,iBAAiB;IACjBC,gBAAgB;AACjB;AAUA,MAAeC;IAEGC,gBAAoD;IAEpDC,kBAA2B,KAAK;IAEzCC,aAAqB,EAAE;IACvBC,aAAqB,EAAE;IACvBC,cAAsB,EAAE;IACxBC,cAAsB,EAAE;IAEfC,kBAA0B,EAAE;IAC5BC,kBAA0B,EAAE;IAC5BC,mBAA2B,EAAE;IAC7BC,mBAA2B,EAAE;IAEtCC,WAA4C,EAAE,CAAC;IAEvDC,YAAYC,OAAgC,CAAE;QAC7C,IAAI,CAACZ,eAAe,GAAGa,OAAOC,MAAM,CAACD,OAAOE,MAAM,CAAC,CAAC,GAAGxB,sBAAsBqB;QAC7E,IAAI,CAACI,cAAc;IACpB;IAEQC,YAAYC,QAAuC,EAAQ;QAClE,OAAQA,SAASC,QAAQ;YACxB,KAAKC,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACC,IAAI;gBAC7CC,QAAQC,IAAI,CAAC,CAAC,gBAAgB,EAAEP,SAASQ,IAAI,CAAC,CAAC;gBAC/C;YACD,KAAKN,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI;gBAC7CH,QAAQI,IAAI,CAAC,CAAC,gBAAgB,EAAEV,SAASQ,IAAI,CAAC,CAAC;gBAC/C;YACD,KAAKN,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACO,KAAK;gBAC9CL,QAAQM,KAAK,CAAC,CAAC,gBAAgB,EAAEZ,SAASQ,IAAI,CAAC,CAAC;gBAChD;YACD,KAAKN,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACS,KAAK;gBAC9CP,QAAQM,KAAK,CAAC,CAAC,gBAAgB,EAAEZ,SAASQ,IAAI,CAAC,CAAC;gBAChD;YACD;gBACCF,QAAQM,KAAK,CAAC,CAAC,2BAA2B,EAAEZ,SAASC,QAAQ,CAAC,CAAC;QACjE;IACD;IAEQa,UAAUd,QAAuC,EAAQ;QAChE,IAAI,CAACR,QAAQ,CAACuB,IAAI,CAACf;QAEnB,OAAQA,SAASC,QAAQ;YACxB,KAAKC,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACC,IAAI;gBAC7C,IAAI,EAAE,IAAI,CAACrB,UAAU,GAAG,IAAI,CAACI,eAAe,EAAE;oBAC7C,IAAI,CAAC4B,MAAM;gBACZ;gBACA;YACD,KAAKd,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI;gBAC7C,IAAI,EAAE,IAAI,CAACxB,UAAU,GAAG,IAAI,CAACI,eAAe,EAAE;oBAC7C,IAAI,CAAC2B,MAAM;gBACZ;gBACA;YACD,KAAKd,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACO,KAAK;gBAC9C,IAAI,EAAE,IAAI,CAACzB,WAAW,GAAG,IAAI,CAACI,gBAAgB,EAAE;oBAC/C,IAAI,CAAC0B,MAAM;gBACZ;gBACA;YACD,KAAKd,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACS,KAAK;gBAC9C,IAAI,EAAE,IAAI,CAAC1B,WAAW,GAAG,IAAI,CAACI,gBAAgB,EAAE;oBAC/C,IAAI,CAACyB,MAAM;gBACZ;gBACA;YACD;gBACCV,QAAQM,KAAK,CAAC,CAAC,2BAA2B,EAAEZ,SAASC,QAAQ,CAAC,CAAC;QACjE;QAEA,IAAI,IAAI,CAAClB,eAAe,EAAE;YACzB,IAAI,CAACgB,WAAW,CAACC;QAClB;IACD;IAEQgB,SAAe;QACtBV,QAAQM,KAAK,CAAC,CAAC,sBAAsB,CAAC;QACtC,KAAK,MAAMK,WAAW,IAAI,CAACzB,QAAQ,CAAE;YACpC,IAAI,CAACO,WAAW,CAACkB;QAClB;QACAC,QAAQC,IAAI,CAAC;IACd;IAEUrB,iBAAuB;QAChC,IAAI,CAACd,UAAU,GAAG;QAClB,IAAI,CAACC,UAAU,GAAG;QAClB,IAAI,CAACC,WAAW,GAAG;QACnB,IAAI,CAACC,WAAW,GAAG;IACpB;IAEUiC,IAAInB,QAA+C,EAAEoB,OAAgB,EAAE,GAAGC,IAAW,EAAQ;QACtG,IAAI,CAACR,SAAS,CAAE,IAAIZ,mBAAc,CAACqB,cAAc,CAACtB,YAAYC,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACO,KAAK,EAAEU,WAAW,YAAYC;IAClI;AAED;AAIO,MAAMlD,mBAAmBS;IAEf2C,MAAcjD,OAAOkD,gBAAgB,CAAC;IACtCC,MAAcnD,OAAOoD,gBAAgB,CAAC;IAE9CC,SAAiB,EAAE;IAE3BnC,YAAYoC,KAAa,EAAEL,MAAcjD,OAAOkD,gBAAgB,EAAEC,MAAcnD,OAAOoD,gBAAgB,EAAEjC,UAAmC,CAAC,CAAC,CAAE;QAC/I,KAAK,CAACA;QACN,IAAI,CAAC8B,GAAG,GAAGA;QACX,IAAI,CAACE,GAAG,GAAGA;QACX,IAAI,CAACG,KAAK,GAAGA;IACd;IAEQC,OAAOD,KAAU,EAAe;QAEvC,IAAI,OAAOA,UAAU,UAAU;YAC9B,OAAOA;QACR,OACK;YAEJ,IAAIA,UAAUE,WAAW;gBACxB,IAAI,CAACX,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI,EAAE;YACrD;YAEA,IAAIoB,UAAU,MAAM;gBACnB,IAAI,CAACT,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI,EAAE;YACrD;YAEA,IAAI,CAACW,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI,EAAE,CAAC,gCAAgC,EAAE,OAAOoB,MAAM,CAAC;YAGrG,MAAMG,WAAWC,SAASJ;YAE1B,IAAI,CAACK,MAAMF,WAAW;gBACrB,IAAI,CAACZ,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACC,IAAI,EAAE,CAAC,qCAAqC,CAAC;gBAC3F,OAAO2B,UAAU,kBAAkB;YACpC;YAEA,MAAMG,aAAaC,WAAWP;YAC9B,IAAI,CAACK,MAAMC,aAAa;gBACvB,IAAI,CAACf,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACC,IAAI,EAAE,CAAC,yCAAyC,CAAC;gBAC/F,OAAOgC,KAAKC,KAAK,CAACH,aAAa,oBAAoB;YACpD;YAEA,MAAMI,aAAahE,OAAOsD;YAC1B,IAAI,CAACK,MAAMK,aAAa;gBACvB,IAAI,CAACnB,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI,EAAE,CAAC,0CAA0C,CAAC;gBAChG,OAAO8B,YAAY,SAAS;YAC7B;YAEA,OAAO;QACR;IACD;IAEQC,OAAOX,KAAa,EAAU;QAErC,IAAIA,QAAQ,CAAC,OAAOA,QAAQ,KAAK;YAChC,IAAI,CAACT,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACK,IAAI,EAAE,CAAC,8CAA8C,EAAEoB,MAAM,CAAC;QAC7G;QAEA,IAAIA,QAAQ,CAAC,KAAK;YACjB,IAAI,CAACT,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACC,IAAI,EAAE,CAAC,sBAAsB,CAAC;YAC5EwB,QAAO;QACR;QAEA,IAAIA,QAAQ,KAAK;YAChB,IAAI,CAACT,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACC,IAAI,EAAE,CAAC,qBAAqB,CAAC;YAC3EwB,QAAQ;QACT;QAEA,OAAOA;IACR;IAEA,IAAIA,QAAgB;QACnB,OAAO,IAAI,CAACD,MAAM;IACnB;IAEA,IAAIC,MAAMA,KAAU,EAAE;QAErB,MAAMY,SAAS,IAAI,CAACX,MAAM,CAACD;QAE3B,IAAIY,WAAW,MAAM;YACpB,IAAI,CAACrB,GAAG,CAAClB,mBAAc,CAACC,YAAY,CAACC,QAAQ,CAACO,KAAK,EAAE,CAAC,yBAAyB,CAAC;QACjF,OACK;YACJ,MAAM+B,UAAU,IAAI,CAACF,MAAM,CAACC;YAE5B,IAAIC,YAAY,IAAI,CAACd,MAAM,EAAE;gBAE5B,IAAI,CAACA,MAAM,GAAGc;YAEf;QACD;QAEA,IAAIb,UAAU,IAAI,CAACD,MAAM,EAAE;YAC1B,IAAI,CAACA,MAAM,GAAGC;QACf;QAEA,IAAI,CAACD,MAAM,GAAGC;IACf;IAEAc,MAAY;QACX,IAAI,CAACd,KAAK;IACX;IAEAe,MAAY;QACX,IAAI,CAACf,KAAK;IACX;AAED"}